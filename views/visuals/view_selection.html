<% menu_section='VISUALS' %>
<% include ../add_ins/begin.ejs %>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.3/dist/leaflet.css"
   integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
   crossorigin=""/>
<%  var cnsts  = JSON.parse(constants) %>
<%  var mtx    = JSON.parse(matrix); %>
<%  var pi     = JSON.parse(post_items); %>
<%  var md     = JSON.parse(metadata); %>
<%  var items  = pi.chosen_datasets; %>
<%  var image_to_rdr  = JSON.parse(image_to_render); %>
<%  var referer = 'view_selection'; %>
<%  var activate_thumbs = true; %>
<%  var visuals = cnsts.VISUAL_THUMBNAILS.visuals %>
<script defer>
  var pi_local  = JSON.parse('<%- post_items %>');
  var mtx_local = JSON.parse('<%- matrix %>');
  var md_local  = JSON.parse('<%- metadata %>');
  var ds_local  = pi_local.chosen_datasets;
  var cts_local  = JSON.parse('<%- constants %>');
  var user_local  = '<%= user.username %>';
  var image_to_rdr_local  = JSON.parse('<%- image_to_render %>');
  var token = '<%- token %>'  // https://leafletjs.com
  //alert(image_to_rdr_local.image)

</script>

<div id='ts_for_bs' style='visibility:hidden'><%= pi.ts %></div>
<div id='found_data' style='visibility:hidden'><%= Object.keys(items) %></div>
<div id='info_bar' class='navbar-fixed-top ' >
  <small>
    <div id='view_selection_links'>
      <ul>
        
        <li>
          <form class='' id='reload_form_id' name='reload_form' method='POST' action='/visuals/view_selection'>

            <input type='submit' value='Reload Page' />
            <input type='hidden' name='normalization' value='<%= pi.normalization %>'>
            <input type='hidden' name='selected_distance' value='<%= pi.selected_distance %>'>
            <input type='hidden' name='min_range' value='<%= pi.min_range %>'>
            <input type='hidden' name='max_range' value='<%= pi.max_range %>'>
            <input type='hidden' name='include_nas' value='<%= pi.include_nas %>'>
            <% if(pi.unit_choice == 'tax_silva119_simple' || pi.unit_choice == 'tax_rdp2.6_simple'){ %>
              <input type='hidden' name='domains' value='<%= pi.domains %>'>
            <% } %>
            <input type='hidden' name='tax_depth' value='<%= pi.tax_depth %>'>
            <input type='hidden' name='unit_choice' value='<%= pi.unit_choice %>'>
            <input type='hidden' name='selected_metadata' value='<%= pi.metadata %>'>
            <input type='hidden' name='retain_data' value='1' >
            <input type='hidden' name='dataset_ids' value='<%= JSON.stringify(Object.keys(items)) %>' >
          </form>
        </li>

        
      </ul>
    </div>

    <div id='viz_info'></div>
  </small>
</div>

<br>
<div class='title title_color_viz'>Community Visualization
    <% if (messages.success) { %>
        <div class="alert_flash_message_success"><%= messages.success %>
        </div>
    <% }else if(messages.fail){ %>
        <div class="alert_flash_message_fail"><%= messages.fail %>
        <br>We recommend tryng a different taxonomy unit, re-selecting data or selecting different data and trying again.
          Contact us at vamps.mbl.edu for help.</div>
    <% } %>
</div>
<div class='subtitle'>Display Choices</div>


  <div class="row">
      <div  id='show_selected_datasets_div'  class="col-lg-3">
        <div class='well'>
              <% include ../partials/show_selected_datasets.html %>
        </div>
      </div>

      <div id='show_selected_metadata_div'  class="col-lg-3">
        <div class='well'>
              <% include ../partials/show_selected_metadata.html %>
        </div>
      </div>

      <div  id='show_select_items_div' class="col-lg-6">
        <div class='well'>
              <% include partials/show_visual_output_choices.html %>
        </div>
      </div>

 <!-- 
     <div  id='show_other_items_div' class="col-lg-3">
        <div class='well'>
          <% include partials/show_parameters.html %>
        </div>
      </div>
 -->

  </div>

<hr>
<% if(mtx.data == '') { %>
<%    activate_thumbs = false %>
      <div id='' class='no_data'>
            <h3>No Data Found</h3>
      </div>
<% }else{ %>
    <div style='float:left;'>
      <table class='button_row'><tr>
      	<td>Downloads: (data selected for this page only)</td>
      	  <td>

            </td>

      	    <!-- This form should run in the background and place the files
      	          in a 'downloads' directory where it can be retrieved.
      	          The user should get an email when its ready.
      	     -->
            <td>
        		<form id='download_fasta_form_id' method='POST' action=''>
        		    <button type='button' id='download_fasta_btn' class="btn btn-xs btn-success">Create Fasta File</button>
        		    <input type='hidden' name='download_type' value='partial_project' />
        			<input type='hidden' name='referer' value='/visuals/view_selection' />
      		  	</form>

      		</td><td>
      		    <button type="button" class="btn btn-xs btn-success" onclick="transfer_file_for_download('metadata','<%= pi.ts %>')">Create Metadata File</button>
<!--
              <form id='download_metadata_form_id' method='POST' action=''>
                    <button type='button' id='download_metadata_btn' class="btn btn-xs btn-success">Create Metadata File</button>
      		        <input type='hidden' name='download_type' value='partial_project' />
      			    <input type='hidden' name='referer' value='/visuals/view_selection' />
      		    </form>
-->
      		</td><td>

                  <form id='download_matrix_form_id'  method='POST' action=''>
                    <button type='button' id='download_matrix_btn' class="btn btn-xs btn-success">Create Counts Matrix File</button>
                    <input type='hidden' name='download_type' value='partial_project' />
                    <input type='hidden' name='ts' value='<%= pi.ts %>' />
                    <input type='hidden' name='referer' value='/visuals/view_selection' />
                  </form>

          </td>
          
          <td> -- </td><td>
            <input type='checkbox' id='more_download_choices' name='more_download_choices' value='closed' onclick='show_more_download_choices()'> 
            <a id='more_download_choices_span' onclick='show_more_download_choices()'>More download choices</a> 
            
            

          
         
          </td>




        </tr>

    </table>

</div>



<div id='more_download_choices_div' style='display:none'>
         
         <table border='0' style='border:1px solid black;margin:3px;'>
         <tr><td style='' colspan='3'> 
              <center>Useful Direct Download Files:</center>
             </td>
             <td></td><td></td>
         </tr>
         <tr><td style='padding:2px 5px'> 
                  <form id='download_phyloseq_mtx_form_id'  method='POST' action='/visuals/download_file'>
                    <button type='submit' id='download_phyloseq_mtx_btn' class="btn btn-xs btn-primary">Matrix File</button>
                    <input type='hidden' name='file_type' value='matrix' />
                    <input type='hidden' name='ts' value='<%= pi.ts %>' />
                    <input type='hidden' name='referer' value='/visuals/view_selection' />
                  </form>
             
             
             </td><td style='padding:2px 5px'> 
                  <form id='download_phyloseq_biom_form_id'  method='POST' action='/visuals/download_file'>
                    <button type='submit' id='download_phyloseq_biom_btn' class="btn btn-xs btn-primary">Biom Matrix File</button>
                    <input type='hidden' name='file_type' value='biom' />
                    <input type='hidden' name='ts' value='<%= pi.ts %>' />
                    <input type='hidden' name='referer' value='/visuals/view_selection' />
                  </form>
             </td><td style='padding:2px 5px'>
                  <form id='download_phyloseq_tax_form_id'  method='POST' action='/visuals/download_file'>
                    <button type='submit' id='download_phyloseq_tax_btn' class="btn btn-xs btn-primary">Taxonomy File</button>
                    <input type='hidden' name='file_type' value='tax' />
                    <input type='hidden' name='ts' value='<%= pi.ts %>' />
                    <input type='hidden' name='referer' value='/visuals/view_selection' />
                  </form>
              </td><td style='padding:2px 5px'>
                  <form id='download_phyloseq_meta_form_id'  method='POST' action='/visuals/download_file'>
                    <button type='submit' id='download_phyloseq_meta_btn' class="btn btn-xs btn-primary">Metadata File</button>
                    <input type='hidden' name='file_type' value='meta' />
                    <input type='hidden' name='ts' value='<%= pi.ts %>' />
                    <input type='hidden' name='referer' value='/visuals/view_selection' />
                  </form>
              </td><td style='padding:2px 5px'>  For input into Python and R (<a href='/help/faq#phyloseq' target='_blank'>phyloseq</a> 
                    and <a href='https://ggplot2.tidyverse.org/' target='_blank'>ggplot</a> libraries) scripts 
              </td>      
          </tr></table>
        
</div>



<% } %>
<% ds_count = mtx.shape[1]; %>
<% tx_count = mtx.shape[0]; %>
<% matrix_size = mtx.shape[0] * mtx.shape[1]; %>
<table border='1' class='table'>
        <tr>

          <% for(n in visuals) {                                              %>
          <%    var thumb = visuals[n].thumb;                                 %>
          <%    var name = visuals[n].name;                                   %>
          <%    var prefix = visuals[n].prefix;                               %>
          <%    var link_id = prefix+'_link_id';                              %>
          <%    var link = '#';                                               %>
          <%    var target='';                                                %>
          <%    var ttip = visuals[n].tip;                                    %>
          <%    var cols = 5                                                  %>
          <%    if((ds_count === 1)  && (prefix === 'dheatmap'
                                        || prefix.substring(0,10) === 'dendrogram'
                                        || prefix === 'fheatmap'
                                        || prefix.substring(0,4)  === 'pcoa' ))           { %>
                    <td class='td_top'><%= name %><br><br>Not Available<br>for single datasets</td>
          <%    } else if(ds_count > 1500  && (prefix.substring(0,8) === 'phyloseq' ))    { %>

                    <td class='td_top' id='<%= ttip %>'>
                            <center>
                                Too Many Datasets Selected<br>
                                 <img src='<%= thumb %>'  border='0' alt='<%= name %>' class='thumb_img' >
                            </center>
                    </td>
          <%    } else if(matrix_size === 0  && (prefix.substring(0,8) === 'phyloseq' ))     { %>
                    <td class='td_top' id='<%= ttip %>'>
                            <center>
                                Not Available<br>
                                 <img src='<%= thumb %>'  border='0' alt='<%= name %>' class='thumb_img' >
                            </center>
                    </td>
          <%    } else {                                                                              %>
          <%        if(activate_thumbs == false) {                                                    %>
                      <td class='td_top'><%= name %><br>
                        <center>
                        <img src='<%= thumb %>' border='0' alt='<%= name %>' class='thumb_img' >
                        </center>
                      </td>
          <%        }else{                                                                            %>
          <%            if(prefix == 'dbrowser'){ %>
          <%              link = 'dbrowser' %>
          <%              target = '_blank' %>
          <%            }else if(prefix == 'oligotypingXX'){ %>
          <%              //link = 'oligotyping' %>
          <%              //target = '_blank' %>
          <%            }else if(prefix == 'pcoa3d'){ %>
          <%              target= '' %>
          <%            } %>

          <%            var phy_lookup = {} %>
          <%                for(var i in mtx.rows){ %>
          <%                  tax_items = mtx.rows[i].id.split(';') %>
          <%                  phy = tax_items[0]+';'+tax_items[1] %>
          <%                  if(tax_items[1] !== 'phylum_NA'){ %>
          <%                    phy_lookup[phy] = tax_items[1] %>
          <%                  } %>
          <%            } %>
          <%            if(prefix == 'pcoa'){                                                %>

          <%               var id1 = 'pcoa_md1'                                               %>
          <%               var id2 = 'pcoa_md2'                                               %>
                            <td class='td_top tooltip_viz_help' id='<%= ttip %>'>
                              <center>
                                <a href='<%= link %>'  target='<%= target %>' id='<%= link_id %>'  >
                                  <%= name %><br>
                                   <img src='<%= thumb %>'  border='0' alt='<%= name %>' class='thumb_img' >
                                </a>
                                    <table><tr><td>Metadata1:&nbsp;</td>
                                      <td>
                                      <select id='<%= id1 %>' name='<%= id1 %>' style='width:120px'>
                                        <option value='Project' selected >Project</option>
                                        <% for(var i in pi.metadata){ %>
                                          <option value='<%= pi.metadata[i] %>'><%= pi.metadata[i] %></option>
                                        <% } %>
                                        <option value='X.SampleID'>Dataset</option>
                                        <option value='Project' >Project</option>
                                      </select>
                                      </td>
                                      </tr><tr>
                                      <td>Metadata2:&nbsp;</td>
                                      <td>
                                      <select id='<%= id2 %>' name='<%= id2 %>' style='width:120px'>
                                        <option value='X.SampleID' selected >Dataset</option>
                                        <% for(var i in pi.metadata){ %>
                                          <option value='<%= pi.metadata[i] %>'><%= pi.metadata[i] %></option>
                                        <% } %>
                                        <option value='X.SampleID'>Dataset</option>
                                        <option value='Project'>Project</option>
                                      </select>
                                    </td></tr>
                                  </table>
                              </center>
                            </td>

          <%            }else if(prefix == 'phyloseq_bars01'){ %>
          <%                var phy_id = 'phyloseq_bar_phylum' %>

                            <td class='td_top tooltip_viz_help' id='<%= ttip %>'>
                              <center>
                                <a href='<%= link %>'  target='<%= target %>' id='<%= link_id %>'  >
                                  <%= name %><br>
                                   <img src='<%= thumb %>'  border='0' alt='<%= name %>' class='thumb_img' >
                                </a>

                              <table><tr><td>Choose Phylum:&nbsp;</td>
                                <td>
                                <select id='<%= phy_id %>' name='<%= phy_id %>' style='width:100px'>
                                  <option value='0'>Choose Phylum</option>

          <%                      for(var phy in phy_lookup){ %>

          <%                          if(image_to_rdr.image == 'phyloseq_bars01' && image_to_rdr.phylum == phy_lookup[phy]){ %>
                                        <option selected value='<%= phy_lookup[phy] %>'><%= phy %></option>
          <%                          }else{ %>
                                        <option value='<%= phy_lookup[phy] %>'><%= phy %></option>
          <%                          } %>
          <%                      } %>

                                </select>
                              </td>
                              </tr></table>
                              </center>
                            </td>
          <%            }else if(prefix == 'phyloseq_hm02'){                                    %>
          <%                var phy_id  = 'phyloseq_heatmap_phylum'                                   %>
          <%                var rank_id = 'phyloseq_heatmap_rank'                                     %>
          <%                var id1     = 'phyloseq_heatmap_md1'                                      %>
          <%                var ordtype = 'phyloseq_heatmap_type'                                     %>

          <%                if(pi.tax_depth=='domain' || pi.tax_depth=='phylum'){ %>
                                <td><center>
                                    <%= name %><br><br><span>Required: Taxonomic depth<br>of 'Class' or deeper</span>
                                  </center>
                                </td>
          <%                }else{ %>
                                <td class='td_top tooltip_viz_help' id='<%= ttip %>'>
                                  <center>
                                  <a href='<%= link %>'  target='<%= target %>' id='<%= link_id %>'  >
                                    <%= name %><br>
                                     <img src='<%= thumb %>'  border='0' alt='<%= name %>' class='thumb_img' >
                                  </a>

                                  <table>
                                    <tr>
                                      <td>Choose Phylum:</td>
                                      <td>
                                        <select id='<%= phy_id %>' name='<%= phy_id %>' style='width:120px'>
                                          <option value='0'>Choose Phylum</option>
          <%                              for(var phy in phy_lookup){ %>
          <%                                  if(image_to_render.image == 'phyloseq_hm02' && image_to_render.phylum == phy_lookup[phy]){ %>
                                                <option selected value='<%= phy_lookup[phy] %>'><%= phy %></option>
          <%                                  }else{ %>
                                                <option value='<%= phy_lookup[phy] %>'><%= phy %></option>
          <%                                  } %>
          <%                              } %>

                                        </select>
                                      </td>
                                    </tr>
                                    <tr>
                                      <td>Subset Rank:</td>
                                      <td><strong><%= pi.tax_depth %></strong></td>
                                    </tr>
                                    <tr>
                                      <td>(x-axis) Variable:&nbsp;</td>
                                      <td>
                                        <select id='<%= id1 %>' name='<%= id1 %>' style='width:120px'>
                                          <option value='Project' selected >Project</option>
                                          <% for(var i in pi.metadata){ %>
                                            <option value='<%= pi.metadata[i] %>'><%= pi.metadata[i] %></option>
                                          <% } %>
                                          <option value='X.SampleID'>Dataset</option>
                                          <option value='Project' >Project</option>
                                        </select>
                                      </td>
                                    </tr>
                                    <tr><td>Ordination Type:</td>
                                      <td>
                                      <input type='radio' name='<%= ordtype %>' id='' value='NMDS' > NMDS&nbsp;&nbsp;
                                      <input type='radio' checked name='<%= ordtype %>' id='' value='PCoA' > PCoA
                                      </td>
                                    </tr>
                                  </table>
                                  </center>
                                </td>
          <%                } %>

          <%            }else if(prefix == 'phyloseq_nw03'){                                    %>

          <%                var id1 = 'phyloseq_network_md1'                                          %>
          <%                var id2 = 'phyloseq_network_md2'                                          %>

                            <td class='td_top tooltip_viz_help' id='<%= ttip %>'>
                              <center>
                                <a href='<%= link %>'  target='<%= target %>' id='<%= link_id %>'  >
                                  <%= name %><br>
                                   <img src='<%= thumb %>'  border='0' alt='<%= name %>' class='thumb_img' >
                                </a>

                              <table><tr>
                                <td>Metadata1 (shape):&nbsp;</td>
                                <td>
                                <select id='<%= id1 %>' name='<%= id1 %>' style='width:120px'>
                                  <option value='Project' selected >Project</option>
                                  <% for(var i in pi.metadata){ %>
                                    <option value='<%= pi.metadata[i] %>'><%= pi.metadata[i] %></option>
                                  <% } %>
                                  <option value='X.SampleID'>Dataset</option>
                                  <option value='Project' >Project</option>
                                </select>
                              </td>
                            </tr><tr>
                              <td>Metadata2 (color):</td>
                              <td>
                                <select id='<%= id2 %>' name='<%= id2 %>' style='width:120px'>
                                  <option value='X.SampleID' selected >Dataset</option>
                                  <% for(var i in pi.metadata){ %>
                                    <option value='<%= pi.metadata[i] %>'><%= pi.metadata[i] %></option>
                                  <% } %>
                                  <option value='X.SampleID'>Dataset</option>
                                  <option value='Project'>Project</option>
                                </select>
                              </td></tr>
                              <tr>
                                <td>Max Distance:</td>
                                <td>
                                  <input type='radio' name='phyloseq_nwk_dist' id='' value='0.1' > 0.1&nbsp;&nbsp;
                                  <input type='radio' name='phyloseq_nwk_dist' id='' value='0.2' > 0.2<br>
                                  <input type='radio' checked name='phyloseq_nwk_dist' id='' value='0.3' > 0.3&nbsp;&nbsp;
                                  <input type='radio' name='phyloseq_nwk_dist' id='' value='0.4' > 0.4
                              </td></tr>
                            </table>
                              </center>
                            </td>
          <%            }else if(prefix == 'phyloseq_ord04'){                                    %>

          <%               var id1 = 'phyloseq_ord_md1'                                               %>
          <%               var id2 = 'phyloseq_ord_md2'                                               %>
          <%               var ordtype = 'phyloseq_ord_type'                                          %>

                            <td class='td_top tooltip_viz_help' id='<%= ttip %>'>
                              <center>
                                <a href='<%= link %>'  target='<%= target %>' id='<%= link_id %>'  >
                                  <%= name %><br>
                                   <img src='<%= thumb %>'  border='0' alt='<%= name %>' class='thumb_img' >
                                </a>

                                    <table><tr>
                                      <td>Metadata1 (shape):&nbsp;</td>
                                      <td>
                                        <select id='<%= id1 %>' name='<%= id1 %>' style='width:120px'>
                                          <option value='Project' selected >Project</option>
                                          <% for(var i in pi.metadata){ %>
                                            <option value='<%= pi.metadata[i] %>'><%= pi.metadata[i] %></option>
                                          <% } %>
                                          <option value='X.SampleID'>Dataset</option>
                                          <option value='Project' >Project</option>
                                        </select>
                                      </td>
                                      </tr><tr>
                                      <td>Metadata2 (color):</td>
                                      <td>
                                        <select id='<%= id2 %>' name='<%= id2 %>' style='width:120px'>
                                          <option value='X.SampleID' selected >Dataset</option>
                                          <% for(var i in pi.metadata){ %>
                                            <option value='<%= pi.metadata[i] %>'><%= pi.metadata[i] %></option>
                                          <% } %>
                                          <option value='X.SampleID'>Dataset</option>
                                          <option value='Project'>Project</option>
                                        </select>
                                      </td>
                                    </tr>
                                    <tr>
                                      <td>Ordination Type:</td>
                                      <td>
                                    <input type='radio' name='<%= ordtype %>' id='<%= ordtype %>' value='NMDS' > NMDS&nbsp;&nbsp;
                                    <input type='radio' checked name='<%= ordtype %>' id='<%= ordtype %>' value='PCoA' > PCoA
                                    </td></tr>
                                  </table>
                              </center>
                            </td>

          <%            }else if(prefix == 'phyloseq_tree05'){                                    %>

          <%               var id1 = 'phyloseq_tree_md1'                                              %>

                            <td class='td_top tooltip_viz_help' id='<%= ttip %>'>
                              <center>
                                <a href='<%= link %>'  target='<%= target %>' id='<%= link_id %>'  >
                                  <%= name %><br>
                                   <img src='<%= thumb %>'  border='0' alt='<%= name %>' class='thumb_img' >
                                </a>

                                  <table><tr>
                                  <td>Metadata (color):&nbsp;</td>
                                  <td>
                                    <select id='<%= id1 %>' name='<%= id1 %>' style='width:120px'>
                                      <option value='X.SampleID' selected >Dataset</option>
                                      <% for(var i in pi.metadata){ %>
                                        <option value='<%= pi.metadata[i] %>'><%= pi.metadata[i] %></option>
                                      <% } %>
                                      <option value='X.SampleID'>Dataset</option>
                                      <option value='Project'>Project</option>
                                    </select>
                                  </td></tr>
                                  </table>
                              </center>
                            </td>


          <%            }else if(prefix == 'oligotyping'){                                            %>

                            <td class='td_top tooltip_viz_help' id='<%= ttip %>'>
                              <center>
                                <a href='<%= link %>'  target='<%= target %>' id='<%= link_id %>'  >
                                  <%= name %><br>
                                   <img src='<%= thumb %>'  border='0' alt='<%= name %>' class='thumb_img' >
                                </a>

                                  <table>
                                    <tr><td>Select to open new window</td></tr>
                                  </table>
                              </center>
                            </td>


          <%            }else{ %>
          <%              if(!(prefix === 'cytoscape' && hostname.substring(0,7) === 'bpcweb8')){ %>
                            <td class='td_top tooltip_viz_help' id='<%= ttip %>'>
                            <center>
                              <a href='<%= link %>'  target='<%= target %>' id='<%= link_id %>'  >
                                <%= name %><br>
                                 <img src='<%= thumb %>'  border='0' alt='<%= name %>' class='thumb_img' >
                              </a>
                            </center>
                            </td>
          <%              }                                                                           %>
          <%            }                                                                             %>

          <%        }                                                                                 %>
          <%    }                                                                                     %>

          <%    if( n % cols === (cols - 1) ) {                                                       %>
                  </tr><tr>
          <%    }                                                                                     %>
          <% }                                                                                        %>
        </tr>
      </table>


<% for(n in visuals) {                                                                                  %>
<%    var prefix   = visuals[n].prefix;                                                                 %>
<%    var name     = visuals[n].name;                                                                   %>
<%    var prediv   = 'pre_'+prefix+'_div'                                                               %>
<%    var div      = prefix+'_div'                                                                      %>
<%    var title    = prefix+'_title'                                                                    %>
<%    var dnld_btn = prefix+'_dnld_btn'                                                                 %>
<%    var hide_btn = prefix+'_hide_btn'                                                                 %>
<%    var open_btn = prefix+'_open_btn'                                                                 %>

    <nav id='<%= prediv %>' class="navbar navbar-inverse viz_hidden_div display_none">
      <div class="navbar-header" >
        <span id='<%= title %>' class="navbar-brand table_title" ><%= name %></span>
      </div>
      <div class='button_div pull-right'>
        <button type='button' id='<%= hide_btn %>' class='close_open_btn btn btn-xs btn-info' value='hide'>Hide Panel</button>
        <button type='button' id='<%= open_btn %>' class='close_open_btn btn btn-xs btn-info' value='open'>New Window</button>
        <button type="button" class="btn btn-xs btn-info" onclick='javascript:window.scrollTo(0,0)'><span class="glyphicon glyphicon-arrow-up"></span>Top</button>
        <li class="dropdown">
          <button disabled id='<%= dnld_btn %>' class="btn btn-xs btn-link dropdown-toggle"  data-toggle="dropdown" role="button" aria-expanded="false">
            Downloads<span class="caret"></span>
          </button>
            <ul class="dropdown-menu" role="menu">
            <% if(prefix=='counts_matrix'){ %>
              <li><button type="button" class="btn-link dropdown_btn" onclick="create_freq_table_file('matrix','<%= pi.ts %>')">as Table (csv)</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="save_image_as_json('counts_matrix','<%= pi.ts %>')">JSON Image Config File</button></li>
            <% }else if(prefix == 'metadata_table') { %>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('metadata','<%= pi.ts %>')">as Table (csv)</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="save_image_as_json('metadata_table','<%= pi.ts %>')">JSON Image Config File</button></li>
            <% }else if(prefix == 'dheatmap') { %>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('distance-py','<%= pi.ts %>')">Distance File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="save_image_as_json('dheatmap','<%= pi.ts %>')">JSON Image Config File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="recreate_image_from_html('dheatmap','<%= pi.ts %>')">Image as PDF</button></li>
            <% }else if(prefix == 'barcharts') { %>
              <!-- <li><button type="button" class="btn-link dropdown_btn" onclick="recreate_image_from_html('barcharts','<%= pi.ts %>')">Image as PDF</button></li> -->
              <li><button type="button" class="btn-link dropdown_btn" onclick="download_svg('barcharts','<%= pi.ts %>')">Image as SVG</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="save_image_as_json('barcharts','<%= pi.ts %>')">JSON Image Config File</button></li>
            <% }else if(prefix == 'piecharts') { %>
              <!-- <li><button type="button" class="btn-link dropdown_btn" onclick="recreate_image_from_html('piecharts','<%= pi.ts %>')">Image as PDF</button></li> -->
              <li><button type="button" class="btn-link dropdown_btn" onclick="download_svg('piecharts','<%= pi.ts %>')">Image as SVG</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="save_image_as_json('piecharts','<%= pi.ts %>')">JSON Image Config File</button></li>
            <% }else if(prefix == 'fheatmap') { %>
              <!-- <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('pdf-fheatmap','<%= pi.ts %>')">PDF Image File</button></li> -->
              <li><button type="button" class="btn-link dropdown_btn" onclick="download_svg('fheatmap','<%= pi.ts %>')">Image as SVG</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="save_image_as_json('fheatmap','<%= pi.ts %>')">JSON Image Config File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('distance-R','<%= pi.ts %>')">Distance File</button></li>
            <% }else if(prefix == 'dbrowser') { %>
            <% }else if(prefix == 'dendrogram01') { %>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('distance-py','<%= pi.ts %>')">Distance File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="save_image_as_json('dendrogram01','<%= pi.ts %>')">JSON Image Config File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('tree-py','<%= pi.ts %>')">Tree File (newick)</button></li>
            <% }else if(prefix == 'dendrogram03') { %>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('distance-py','<%= pi.ts %>')">Distance File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="save_image_as_json('dendrogram03','<%= pi.ts %>')">JSON Image Config File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('tree-py','<%= pi.ts %>')">Tree File (newick)</button></li>
            <% }else if(prefix == 'pcoa') { %>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('pdf-pcoa','<%= pi.ts %>')">PDF Image File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="save_image_as_json('pcoa','<%= pi.ts %>')">JSON Image Config File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('distance-R','<%= pi.ts %>')">Distance File</button></li>
            <% }else if(prefix == 'pcoa3d') { %>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('distance-py','<%= pi.ts %>')">Distance File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="save_image_as_json('pcoa3d','<%= pi.ts %>')">JSON Image Config File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('emperor-pc','<%= pi.ts %>')">Principal Components File</button></li>
            <% }else if(prefix == 'geospatial') { %>
              <li><button type="button" class="btn-link dropdown_btn" onclick="save_image_as_json('geospatial','<%= pi.ts %>')">JSON Image Config File</button></li>
            <% }else if(prefix == 'adiversity') { %>
              <li><button type="button" class="btn-link dropdown_btn" onclick="save_image_as_json('adiversity','<%= pi.ts %>')">JSON Image Config File</button></li>
            <% }else if(prefix == 'phyloseq_bars01') { %>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('phyloseq-biom','<%= pi.ts %>')">Biom Matrix File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('phyloseq-tax','<%= pi.ts %>')">Taxonomy Names File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('metadata','<%= pi.ts %>')">Metadata File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="save_image_as_json('phyloseq_bars01','<%= pi.ts %>')">JSON Image Config File</button></li>
            <% }else if(prefix == 'phyloseq_hm02') { %>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('phyloseq-biom','<%= pi.ts %>')">Biom Matrix File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('phyloseq-tax','<%= pi.ts %>')">Taxonomy Names File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('metadata','<%= pi.ts %>')">Metadata File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('distance-R','<%= pi.ts %>')">Distance File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="save_image_as_json('phyloseq_hm02','<%= pi.ts %>')">JSON Image Config File</button></li>
            <% }else if(prefix == 'phyloseq_nw03') { %>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('phyloseq-biom','<%= pi.ts %>')">Biom Matrix File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('phyloseq-tax','<%= pi.ts %>')">Taxonomy Names File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('metadata','<%= pi.ts %>')">Metadata File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('distance-R','<%= pi.ts %>')">Distance File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="save_image_as_json('phyloseq_nw03','<%= pi.ts %>')">JSON Image Config File</button></li>
            <% }else if(prefix == 'phyloseq_ord04') { %>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('phyloseq-biom','<%= pi.ts %>')">Biom Matrix File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('phyloseq-tax','<%= pi.ts %>')">Taxonomy Names File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('metadata','<%= pi.ts %>')">Metadata File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('distance-R','<%= pi.ts %>')">Distance File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="save_image_as_json('phyloseq_ord04','<%= pi.ts %>')">JSON Image Config File</button></li>
            <% }else if(prefix == 'phyloseq_tree05') { %>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('phyloseq-biom','<%= pi.ts %>')">Biom Matrix File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('phyloseq-tax','<%= pi.ts %>')">Taxonomy Names File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('metadata','<%= pi.ts %>')">Metadata File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('phyloseq-tree','<%= pi.ts %>')">Tree File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('distance-R',<%= pi.ts %>')">Distance File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="save_image_as_json('phyloseq_tree05','<%= pi.ts %>')">JSON Image Config File</button></li>
            <% }else if(prefix == 'cytoscape') { %>
            <% }else if(prefix == 'dendrogram') { %>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('distance-py','<%= pi.ts %>')">Distance File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="save_image_as_json('dendrogram','<%= pi.ts %>')">JSON Image Config File</button></li>
              <li><button type="button" class="btn-link dropdown_btn" onclick="transfer_file_for_download('tree-py','<%= pi.ts %>')">Tree File (newick)</button></li>
            <% } %>
            </ul>
        </li>
      </div>
    </nav>
    <center><div id='<%= div %>'   class='display_none well overflow_500'></div></center>


<% } %>





  <div id='counts_tooltip_div' class=''></div>
  <div id='piebarcharts_tooltip_div' class=''></div>
  <div id='q' class=''></div>



  <% include ../add_ins/end.ejs %>
 <script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet.js"
   integrity="sha512-tAGcCfR4Sc5ZP5ZoVz0quoZDYX5aCtEm/eu1KhSLj2c9eFrylXZknQYmxUssFaVJKvvc0dJQixhGjG2yXWiV9Q=="
   crossorigin="">   
 </script>
 <script type="text/javascript" src="/javascripts/tablesort.min.js" defer></script>>
 <script type="text/javascript" src="/javascripts/jquery.scrollTo.min.js" defer></script>>
 <script type="text/javascript" src="/javascripts/jquery.tablednd.js" defer></script>>
 <script type="text/javascript" src="/javascripts/d3.min.js" charset="utf-8" defer></script>>
 <script type="text/javascript" src="/javascripts/d3pie.min.js" charset="utf-8" defer></script>>

 <script type="text/javascript" src="/javascripts/d3.phylogram.js" charset="utf-8" defer></script>>
 <script type="text/javascript" src="/javascripts/d3.phylonator.js" charset="utf-8" defer></script>>

 <script type="text/javascript" src="/javascripts/newick.js" charset="utf-8" defer></script>>
 <script type="text/javascript" src="/javascripts/drag_rows.js" defer></script>>
 <script type="text/javascript" src="/javascripts/global.js" defer></script>>
 <script type="text/javascript" src="/javascripts/common_selection.js" defer></script>>
 <script type="text/javascript" src="/javascripts/view_selection.js" defer></script>>
 <script type="text/javascript" src="/javascripts/visual_divs.js" defer></script>>
 <script type="text/javascript" src="/javascripts/bootstrap-select.js" defer></script>>
 <script type="text/javascript" src="/javascripts/jquery.flot.min.js" defer></script>>

 <script type="text/javascript" src="/javascripts/cytoscape.min.js" defer></script>>
 <script type="text/javascript" src="/javascripts/tooltipster.bundle.min.js" defer></script>>
 <script type="text/javascript" src="/javascripts/he.js" defer></script>>
 

<script defer>
//         $(document).ready(function() {
//             $('.totip').tooltipster();
//         });

</script>

</body>
</html>
